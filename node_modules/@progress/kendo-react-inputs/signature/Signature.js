/**
 * @license
 *-------------------------------------------------------------------------------------------
 * Copyright Â© 2024 Progress Software Corporation. All rights reserved.
 * Licensed under commercial license. See LICENSE.md in the package root for more information
 *-------------------------------------------------------------------------------------------
 */
"use client";"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const Ce=require("@progress/kendo-inputs-common"),B=require("@progress/kendo-react-buttons"),r=require("@progress/kendo-react-common"),he=require("@progress/kendo-react-dialogs"),Se=require("@progress/kendo-react-intl"),a=require("prop-types"),ze=require("react"),p=require("../messages/index.js"),Oe=require("../package-metadata.js"),Ee=require("./utils/index.js"),_=require("@progress/kendo-svg-icons");function xe(c){const b=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(c){for(const f in c)if(f!=="default"){const e=Object.getOwnPropertyDescriptor(c,f);Object.defineProperty(b,f,e.get?e:{enumerable:!0,get:()=>c[f]})}}return b.default=c,Object.freeze(b)}const n=xe(ze),Me=250,Ie=84,te=3,ne=2,we="#000000",Pe="#ffffff",ee=c=>c!==void 0,oe=r.createPropsContext(),O=n.forwardRef((c,b)=>{r.validatePackage(Oe.packageMetadata);const f=r.usePropsContext(oe,c),e=n.useMemo(()=>({strokeWidth:l.strokeWidth,smooth:l.smooth,popupScale:l.popupScale,exportScale:l.exportScale,maximizable:l.maximizable,disabled:l.disabled,required:l.required,validityStyles:l.validityStyles,onChange:l.onChange,onFocus:l.onFocus,onBlur:l.onBlur,onOpen:l.onOpen,onClose:l.onClose,size:l.size,rounded:l.rounded,fillMode:l.fillMode,...f}),[f]),E=Se.useLocalization(),d=n.useRef(null),y=n.useRef(null),N=n.useRef(null),F=n.useRef(null),x=n.useRef(null),[s,ae]=n.useState(),[v,j]=n.useState(!1),[M,G]=n.useState(!1),[C,W]=n.useState(),[se,re]=n.useState(),A=ee(e.value)?e.value:C,[ie,le]=n.useState(!1),k=ee(e.open),g=k?e.open:ie,ce=e.maximized||M||!e.maximizable||e.disabled,ue=!(e.maximized&&!M),de=!(!(e.value||C)||M||e.readOnly||e.disabled),V=E.toLanguageString(p.signatureMaximize,p.messages[p.signatureMaximize]),U=E.toLanguageString(p.signatureMinimize,p.messages[p.signatureMinimize]),H=E.toLanguageString(p.signatureClear,p.messages[p.signatureClear]),I=e.popupScale||te,w=e.exportScale||ne,P=t=>{W(t),e.onChange&&e.onChange({value:t})},me=t=>{s==null||s.loadImage(t.value),P(t.value)};n.useEffect(()=>{e.value!==C&&(W(e.value),s==null||s.loadImage(e.value))},[e.value]);const pe=()=>{s==null||s.clear(),P()},h=n.useCallback(t=>{k||le(t)},[k]),fe=t=>{var o,i;Q(t),(i=((o=x.current)==null?void 0:o.element)||y.current)==null||i.focus()},L=n.useCallback(()=>{let t=we;return!e.color&&typeof document!="undefined"&&d.current&&(t=getComputedStyle(d.current).color),e.color||t},[e.color]),q=n.useCallback(()=>{let t=Pe;return!e.backgroundColor&&typeof document!="undefined"&&d.current&&(t=getComputedStyle(d.current).backgroundColor),e.backgroundColor||t},[e.backgroundColor]),$=()=>({scale:e.maximized?e.popupScale:1,color:L(),backgroundColor:q(),strokeWidth:e.strokeWidth,smooth:e.smooth,readonly:e.readOnly}),K=async t=>{const{width:o,height:i}=t;return await(s==null?void 0:s.exportImage({width:o*w,height:i*w}))};n.useEffect(()=>{const t=y.current,o=new Ce.SignaturePad(t,$());return A&&o.loadImage(A),ae(o),()=>o.destroy()},[]),n.useEffect(()=>{s==null||s.setOptions({onChange:async()=>P(await K(Y())),onDraw:()=>G(!0),onDrawEnd:()=>G(!1)})},[s]),r.useIsomorphicLayoutEffect(()=>s==null?void 0:s.setOptions($()),[e.readOnly,e.color,e.backgroundColor,e.strokeWidth,e.smooth]),n.useEffect(()=>{var i,u;const t=(u=(i=N.current)==null?void 0:i.element)==null?void 0:u.querySelector(".k-overlay");if(!t)return;const o=()=>h(!1);return t.addEventListener("click",o),()=>t.removeEventListener("click",o)},[g]),n.useEffect(()=>{if(!g||typeof document=="undefined")return;const t=o=>{var i,u;o.key==="Escape"&&(h(!1),(u=(i=x.current)==null?void 0:i.element)==null||u.focus())};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[g]),n.useEffect(()=>{var t,o;e.maximized&&((o=(t=F.current)==null?void 0:t.element)==null||o.focus())},[]);const D=n.useCallback(()=>{var t;return(t=y.current)==null?void 0:t.focus()},[]),S=n.useCallback(()=>e.value,[e.value]),X=n.useCallback(()=>e.name,[e.name]),z=n.useCallback(()=>e.required,[e.required]),R=n.useCallback(()=>{const t=e.validationMessage!==void 0,i=!S(),u=e.valid!==void 0?e.valid:!z()||!i;return{customError:t,valid:u,valueMissing:i}},[e.validationMessage,e.valid,S,z]),T=n.useCallback(()=>e.validityStyles,[e.validityStyles]),J=n.useCallback(()=>e,[e]),m=n.useCallback(()=>{const t={element:d.current,focus:D};return Object.defineProperty(t,"name",{get:X}),Object.defineProperty(t,"value",{get:S}),Object.defineProperty(t,"validity",{get:R}),Object.defineProperty(t,"validityStyles",{get:T}),Object.defineProperty(t,"required",{get:z}),Object.defineProperty(t,"props",{get:J}),Object.defineProperty(t,"color",{get:L}),Object.defineProperty(t,"backgroundColor",{get:q}),t},[X,S,R,T,z,D,J,L,q]);n.useImperativeHandle(b,m);const ge=n.useCallback(t=>{v||e.maximized||(j(!0),r.dispatchEvent(e.onFocus,t,m(),{}))},[v,e.onFocus,m]),be=n.useCallback(t=>{Ee.hasParent(t.relatedTarget,d.current)||(j(!1),r.dispatchEvent(e.onBlur,t,m(),{}))},[v,e.onBlur,m]),ke=n.useCallback(async t=>{re(await K(Z())),h(!0),r.dispatchEvent(e.onOpen,t,m(),{})},[g,k,e.onOpen,e.value,C,m]),Q=n.useCallback(t=>{h(!1),r.dispatchEvent(e.onClose,t,m(),{})},[g,k,e.onClose,m]),ye=()=>{pe(),D()},Y=()=>{var i,u;const t=e.width||((i=d.current)==null?void 0:i.offsetWidth)||Me,o=e.height||((u=d.current)==null?void 0:u.offsetHeight)||Ie;return{width:t,height:o}},Z=()=>{const{width:t,height:o}=Y();return{width:t*I,height:o*I}},ve=!T()||R().valid;return n.createElement("div",{ref:d,dir:e.dir,style:{width:e.width,height:e.height,...e.style},className:r.classNames("k-input","k-signature",{"k-signature-maximized":e.maximized,[`k-signature-${r.kendoThemeMaps.sizeMap[e.size]||e.size}`]:e.size,[`k-signature-${e.fillMode}`]:e.fillMode,[`k-input-${e.fillMode}`]:e.fillMode,[`k-rounded-${r.kendoThemeMaps.roundedMap[e.rounded]||e.rounded}`]:e.rounded,"k-invalid":!ve,"k-required":e.required,"k-disabled":e.disabled,"k-focus":v},e.className),onFocus:ge,onBlur:be},n.createElement("div",{className:"k-signature-canvas",ref:y,tabIndex:r.getTabIndex(e.tabIndex,e.disabled),role:"img",id:e.id,"aria-label":e.ariaLabel,"aria-labelledby":e.ariaLabelledBy,"aria-describedby":e.ariaDescribedBy,"aria-disabled":e.disabled?"true":void 0}),n.createElement("div",{className:"k-signature-actions k-signature-actions-top"},n.createElement(B.Button,{type:"button",className:r.classNames("k-signature-action","k-signature-maximize",{"k-hidden":e.disabled||ce}),ref:x,icon:"hyperlink-open",svgIcon:_.hyperlinkOpenIcon,fillMode:"flat",size:e.size,onClick:ke,"aria-label":V,title:V}),n.createElement(B.Button,{type:"button",className:r.classNames("k-signature-action","k-signature-minimize","k-rotate-180",{"k-hidden":e.disabled||ue}),ref:F,icon:"hyperlink-open",svgIcon:_.hyperlinkOpenIcon,fillMode:"flat",size:e.size,onClick:Q,"aria-label":U,title:U})),!e.hideLine&&n.createElement("div",{className:"k-signature-line",style:{zIndex:2,pointerEvents:"none"}}),n.createElement("div",{className:"k-signature-actions k-signature-actions-bottom"},de&&n.createElement(B.Button,{type:"button",className:"k-signature-action k-signature-clear",icon:"x",svgIcon:_.xIcon,fillMode:"flat",size:e.size,onClick:ye,"aria-label":H,title:H})),g&&n.createElement(he.Dialog,{ref:N},n.createElement(O,{...e,...Z(),value:se,maximized:!0,exportScale:1/I*w,open:!1,onChange:me,onClose:fe})))});O.propTypes={value:a.string,width:a.number,height:a.number,tabIndex:a.number,dir:a.string,ariaDescribedBy:a.string,ariaLabelledBy:a.string,ariaLabel:a.string,readOnly:a.bool,disabled:a.bool,validationMessage:a.string,required:a.bool,onChange:a.func,onFocus:a.func,onBlur:a.func,onOpen:a.func,onClose:a.func,size:a.oneOf([null,"small","medium","large"]),rounded:a.oneOf([null,"small","medium","large"]),fillMode:a.oneOf([null,"solid","flat","outline"])};const l={strokeWidth:1,smooth:!1,popupScale:te,exportScale:ne,maximizable:!0,disabled:!1,required:!1,validityStyles:!0,onChange:c=>r.noop,onFocus:c=>r.noop,onBlur:c=>r.noop,onOpen:c=>r.noop,onClose:c=>r.noop,size:"medium",rounded:"medium",fillMode:"solid"};O.displayName="KendoSignature";exports.Signature=O;exports.SignaturePropsContext=oe;
